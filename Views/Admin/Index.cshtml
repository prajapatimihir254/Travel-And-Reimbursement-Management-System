@model BizTravel.Models.AdminDashboardVM

@{
    ViewData["title"] = "Admin Dashboard";
}

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
    body {
        font-family: 'Poppins', sans-serif;
        background-color: #f4f6f9; /* Light Grey Background */
    }

    /* Header Section */
    .dashboard-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
    }

    .page-title {
        font-weight: 700;
        color: #2c3e50;
        border-left: 5px solid #0d6efd;
        padding-left: 15px;
    }

    /* Stats Cards */
    .stat-card {
        border: none;
        border-radius: 15px;
        padding: 20px;
        color: white;
        position: relative;
        overflow: hidden;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        height: 100%;
    }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.2);
        }

        .stat-card h6 {
            font-size: 0.9rem;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-card h2 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-top: 10px;
        }

    .stat-icon {
        position: absolute;
        right: 20px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 3.5rem;
        opacity: 0.2;
    }

    /* Gradients matching Login Page */
    .bg-gradient-primary {
        background: linear-gradient(135deg, #0d6efd, #0099ff);
    }
    /* Blue */
    .bg-gradient-warning {
        background: linear-gradient(135deg, #ffc107, #ff9800);
    }
    /* Orange */
    .bg-gradient-info {
        background: linear-gradient(135deg, #0dcaf0, #00d2ff);
    }
    /* Cyan */
    .bg-gradient-success {
        background: linear-gradient(135deg, #198754, #28a745);
    }
    /* Green */

    /* Chart Containers */
    .chart-card {
        background: white;
        border-radius: 15px;
        padding: 25px;
        border: none;
        box-shadow: 0 5px 20px rgba(0,0,0,0.05);
        margin-bottom: 30px;
    }

    .chart-header {
        font-weight: 600;
        color: #495057;
        margin-bottom: 20px;
        border-bottom: 1px solid #eee;
        padding-bottom: 10px;
    }

    /* Modern Table */
    .table-card {
        background: white;
        border-radius: 15px;
        box-shadow: 0 5px 20px rgba(0,0,0,0.05);
        padding: 25px;
        overflow: hidden;
    }

    .table thead th {
        background-color: #f1f5f9;
        color: #495057;
        font-weight: 600;
        border: none;
        padding: 15px;
    }

    .table tbody td, .table tbody th {
        padding: 15px;
        vertical-align: middle;
        border-bottom: 1px solid #f1f5f9;
    }

    .table-hover tbody tr:hover {
        background-color: #f8f9fa;
    }

    .btn-download {
        background-color: #dc3545;
        color: white;
        border-radius: 50px;
        padding: 10px 25px;
        font-weight: 500;
        transition: 0.3s;
    }

        .btn-download:hover {
            background-color: #c82333;
            color: white;
            transform: scale(1.05);
        }

    .btn-add-user {
        background: linear-gradient(135deg, #0d6efd, #0056b3);
        color: white;
        border-radius: 50px;
        padding: 8px 25px;
        box-shadow: 0 4px 10px rgba(13, 110, 253, 0.3);
    }
</style>

<div class="container-fluid px-4 mt-4">

    <div class="dashboard-header">
        <h2 class="page-title">Admin Dashboard 🛡️</h2>
        <a asp-action="DownloadReport" class="btn btn-download shadow">
            <i class="bi bi-file-earmark-pdf-fill me-2"></i> Download Report
        </a>
    </div>

    <div class="row g-4 mb-5">
        <div class="col-md-3">
            <div class="stat-card bg-gradient-primary">
                <h6>Total Requests</h6>
                <h2>@Model.TotalRequests</h2>
                <i class="bi bi-list-task stat-icon"></i>
            </div>
        </div>

        <div class="col-md-3">
            <div class="stat-card bg-gradient-warning">
                <h6>Pending Approvals</h6>
                <h2>@Model.PendingRequests</h2>
                <i class="bi bi-hourglass-split stat-icon"></i>
            </div>
        </div>

        <div class="col-md-3">
            <div class="stat-card bg-gradient-info text-white">
                <h6>Settled Claims</h6>
                <h2>@Model.SettledRequests</h2>
                <i class="bi bi-check2-all stat-icon"></i>
            </div>
        </div>

        <div class="col-md-3">
            <div class="stat-card bg-gradient-success">
                <h6>Total Settled Amount</h6>
                <h2>₹@Model.TotalSettledAmount.ToString("N2")</h2>
                <i class="bi bi-currency-rupee stat-icon"></i>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-4 col-md-12">
            <div class="chart-card h-100">
                <h5 class="chart-header">Request Status Distribution</h5>
                <div style="position: relative; height:300px; display:flex; justify-content:center;">
                    <canvas id="statusChart"></canvas>
                </div>
            </div>
        </div>

        <div class="col-lg-8 col-md-12">
            <div class="chart-card h-100">
                <h5 class="chart-header">Monthly Expense Trend</h5>
                <div style="position: relative; height:300px; width:100%">
                    <canvas id="expenseChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <div class="row mt-5 mb-5">
        <div class="col-12">
            <div class="table-card">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h4 class="fw-bold text-secondary mb-0">User Management</h4>
                    <a asp-action="CreateUser" class="btn btn-add-user no-print">
                        <i class="bi bi-person-plus-fill me-2"></i> Add New User
                    </a>
                </div>

                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Emp ID</th>
                                <th>Full Name</th>
                                <th>Email</th>
                                <th>Role</th>
                                <th>Department</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var user in Model.UserList)
                            {
                                <tr>
                                    <th class="text-primary">@user.EmployeeID</th>
                                    <td class="fw-bold">@user.Fullname</td>
                                    <td class="text-muted">@user.Email</td>
                                    <td>
                                        @if (user.Role == "Admin")
                                        {
                                            <span class="badge bg-primary rounded-pill">Admin</span>
                                        }
                                        else if (user.Role == "Manager")
                                        {

                                            <span class="badge bg-success rounded-pill">Manager</span>
                                        }
                                        else if (user.Role == "Accountant")
                                        {

                                            <span class="badge bg-warning text-dark rounded-pill">Accountant</span>
                                        }
                                        else
                                        {

                                            <span class="badge bg-info text-dark rounded-pill">Employee</span>
                                        }
                                    </td>
                                    <td>@user.Department</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

</div>


    @section Scripts {
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script>
            const ctx = document.getElementById('statusChart').getContext('2d');
            const statusChart = new Chart(ctx,{
                type: 'pie',
                data: {
                    labels: ['Pending','Settled','Rejected'],
                    datasets: [{
                        data: [@Model.PendingRequests,@Model.SettledRequests,@Model.RejectedRequests],
                        backgroundColor: ['#ffc107','#198754','#dc3545'],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive:true,
                    plugins: {
                        legend: {position:'bottom'}
                    }
                }
            });

        </script>
        @* <script>
            //Expense Line Chart
            const ctxExpense = document.getElementById('expenseChart').getContext('2d');

            //controller's data come to the javascript
            const labels = @Html.Raw(Json.Serialize(Model.MonthlyExpenses.Select(x => x.MonthName)));
            const dataValues = @Html.Raw(Json.Serialize(Model.MonthlyExpenses.Select(x => x.TotalAmount)));

            new Chart(ctxExpense, {
                type:'line',
                data:{
                    labels: labels,
                    datasets:[{
                        label: 'Monthly Settlement (₹)',
                        data: dataValues,
                        borderColor: '#0d6efd',
                        backgroundColor: 'rgba(13,110,253,0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options:{
                    responsive:true,
                    scales:{
                        y:{beginAtZero:true}
                    }
                }
            });
        </script> *@

    <script>
        const ctxExpense = document.getElementById('expenseChart').getContext('2d');

        // Data from Controller
        const labels = @Html.Raw(Json.Serialize(Model.MonthlyExpenses.Select(x => x.MonthName)));
        const dataValues = @Html.Raw(Json.Serialize(Model.MonthlyExpenses.Select(x => x.TotalAmount)));

        // Gradient Fill Logic
        let gradient = ctxExpense.createLinearGradient(0, 0, 0, 400);
        gradient.addColorStop(0, 'rgba(13, 110, 253, 0.5)'); // Blue top
        gradient.addColorStop(1, 'rgba(13, 110, 253, 0.0)'); // Transparent bottom

        new Chart(ctxExpense, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Monthly Settlement (₹)',
                    data: dataValues,
                    borderColor: '#0d6efd',
                    backgroundColor: gradient, 
                    fill: true,
                    tension: 0.4, 
                    pointBackgroundColor: '#fff',
                    pointBorderColor: '#0d6efd',
                    pointRadius: 5,
                    pointHoverRadius: 7
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        backgroundColor: '#2c3e50',
                        padding: 10,
                        displayColors: false,
                        callbacks: {
                            label: function(context) {
                                return '₹ ' + context.parsed.y.toLocaleString();
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: { borderDash: [5, 5], color: '#f0f0f0' },
                        ticks: { callback: function(value) { return '₹' + value; } }
                    },
                    x: {
                        grid: { display: false }
                    }
                }
            }
        });
    </script>

    }






